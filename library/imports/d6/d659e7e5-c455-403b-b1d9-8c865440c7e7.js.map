{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\Game.js"],"names":["cc","Class","extends","Component","properties","starPreFab","default","type","Prefab","maxStarDuration","minStarDuration","ground","Node","player","scoreDisplay","Label","scoreAudio","AudioClip","onLoad","groundY","y","height","timer","starDuration","spawnNewStar","score","gainScore","string","audioEngine","playEffect","gameOver","stopAllActions","director","loadScene","newStar","instantiate","node","addChild","setPosition","getNewStarPosition","getComponent","game","Math","random","randX","randY","jumpHeight","maxX","width","v2","update","dt"],"mappings":";;;;;;AAAAA,GAAGC,KAAH,CAAS;AACLC,aAASF,GAAGG,SADP;;AAGLC,gBAAY;AACR;AACAC,oBAAW;AACPC,qBAAQ,IADD;AAEPC,kBAAKP,GAAGQ;AAFD,SAFH;AAMR;AACAC,yBAAgB,CAPR;AAQRC,yBAAgB,CARR;AASR;AACAC,gBAAO;AACHL,qBAAQ,IADL;AAEHC,kBAAKP,GAAGY;AAFL,SAVC;AAcR;AACAC,gBAAO;AACHP,qBAAQ,IADL;AAEHC,kBAAKP,GAAGY;AAFL,SAfC;AAmBR;AACAE,sBAAa;AACTR,qBAAQ,IADC;AAETC,kBAAKP,GAAGe;AAFC,SApBL;AAwBRC,oBAAW;AACPV,qBAAQ,IADD;AAEPC,kBAAKP,GAAGiB;AAFD;AAxBH,KAHP;;AAiCJC,UAjCI,oBAiCM;AACN;AACA,aAAKC,OAAL,GAAe,KAAKR,MAAL,CAAYS,CAAZ,GAAgB,KAAKT,MAAL,CAAYU,MAAZ,GAAmB,CAAlD;AACA;AACA,aAAKC,KAAL,GAAa,CAAb;AACA,aAAKC,YAAL,GAAoB,CAApB;AACA;AACA,aAAKC,YAAL;AACA;AACA,aAAKC,KAAL,GAAa,CAAb;AACH,KA3CG;;AA4CJC,eAAU,qBAAU;AAAC;AAClB,aAAKD,KAAL,IAAc,CAAd,CADiB,CACD;AAChB,aAAKX,YAAL,CAAkBa,MAAlB,GAA2B,WAAW,KAAKF,KAA3C;AACA;AACAzB,WAAG4B,WAAH,CAAeC,UAAf,CAA0B,KAAKb,UAA/B,EAA0C,KAA1C;AACF,KAjDG;AAkDJc,cAAS,oBAAU;AAAC;AACjB,aAAKjB,MAAL,CAAYkB,cAAZ,GADgB,CACa;AAC7B/B,WAAGgC,QAAH,CAAYC,SAAZ,CAAsB,MAAtB,EAFgB,CAEc;AAChC,KArDG;AAsDJT,kBAAa,wBAAU;AACnB;AACA,YAAIU,UAAUlC,GAAGmC,WAAH,CAAe,KAAK9B,UAApB,CAAd;AACA;AACA,aAAK+B,IAAL,CAAUC,QAAV,CAAmBH,OAAnB;AACA;AACAA,gBAAQI,WAAR,CAAoB,KAAKC,kBAAL,EAApB;AACA;AACAL,gBAAQM,YAAR,CAAqB,MAArB,EAA6BC,IAA7B,GAAoC,IAApC;AACA;AACA,aAAKlB,YAAL,GAAoB,KAAKb,eAAL,GAAuBgC,KAAKC,MAAL,MAAiB,KAAKlC,eAAL,GAAqB,KAAKC,eAA3C,CAA3C;AACA,aAAKY,KAAL,GAAa,CAAb;AACH,KAlEG;AAmEJiB,wBAAmB,8BAAU;AACzB,YAAIK,QAAQ,CAAZ;AACA;AACA,YAAIC,QAAQ,KAAK1B,OAAL,GAAeuB,KAAKC,MAAL,KAAgB,KAAK9B,MAAL,CAAY2B,YAAZ,CAAyB,QAAzB,EAAmCM,UAAlE,GAA+E,EAA3F;AACA;AACA,YAAIC,OAAO,KAAKX,IAAL,CAAUY,KAAV,GAAgB,CAA3B;AACAJ,gBAAQ,CAACF,KAAKC,MAAL,KAAgB,GAAjB,IAAwB,CAAxB,GAA4BI,IAApC;AACA;AACA,eAAO/C,GAAGiD,EAAH,CAAML,KAAN,EAAYC,KAAZ,CAAP;AACH,KA5EG;AA6EJK,UA7EI,kBA6EIC,EA7EJ,EA6EQ;AACT;AACA,YAAG,KAAK7B,KAAL,GAAa,KAAKC,YAArB,EAAkC;AAC9B,iBAAKO,QAAL;AACH;AACD,aAAKR,KAAL,IAAc6B,EAAd;AACF;AAnFG,CAAT","file":"Game.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        //这个属性引用星星的预制资源\r\n        starPreFab:{\r\n            default:null,\r\n            type:cc.Prefab\r\n        },\r\n        //星星消失后时间的随机范围\r\n        maxStarDuration:0,\r\n        minStarDuration:0,\r\n        //地面节点用于生成星星生成的高度\r\n        ground:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        //player节点，用于获取主角的高度\r\n        player:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        //score label引用\r\n        scoreDisplay:{\r\n            default:null,\r\n            type:cc.Label\r\n        },\r\n        scoreAudio:{\r\n            default:null,\r\n            type:cc.AudioClip\r\n        },\r\n    },\r\n\r\n     onLoad () {\r\n         //获取地平面的的y轴坐标\r\n         this.groundY = this.ground.y + this.ground.height/2;\r\n         //初始化计时器\r\n         this.timer = 0;\r\n         this.starDuration = 0;\r\n         //绘制一个新的星星\r\n         this.spawnNewStar();\r\n         //初始化score\r\n         this.score = 0;\r\n     },\r\n     gainScore:function(){//计算得分\r\n        this.score += 1;//每摘到一个星星score加一\r\n        this.scoreDisplay.string = 'Score:' + this.score;\r\n        //播放得分音效\r\n        cc.audioEngine.playEffect(this.scoreAudio,false);\r\n     },\r\n     gameOver:function(){//游戏结束\r\n        this.player.stopAllActions();//停止Player节点的跳跃动作\r\n        cc.director.loadScene('game');//重新加载场景\r\n     },\r\n     spawnNewStar:function(){\r\n         //使用预制资源生成一个新的节点\r\n         var newStar = cc.instantiate(this.starPreFab);\r\n         //将生成的节点添加到Canvas节点下\r\n         this.node.addChild(newStar);\r\n         //为星星设置一个随机位置\r\n         newStar.setPosition(this.getNewStarPosition());\r\n         //在星星组件上暂存Game对象的引用\r\n         newStar.getComponent('Star').game = this;\r\n         //重置计数器，根据消失时间随机一个数\r\n         this.starDuration = this.minStarDuration + Math.random() * (this.maxStarDuration-this.minStarDuration);\r\n         this.timer = 0;\r\n     },\r\n     getNewStarPosition:function(){\r\n         var randX = 0;\r\n         //根据地平线的位置和主角高度，随机得到星星的y坐标\r\n         var randY = this.groundY + Math.random() * this.player.getComponent('Player').jumpHeight + 50;\r\n         //根据屏幕宽度，随机星星的x轴坐标\r\n         var maxX = this.node.width/2;\r\n         randX = (Math.random() - 0.5) * 2 * maxX;\r\n         //返回星星坐标\r\n         return cc.v2(randX,randY);\r\n     },\r\n     update (dt) {\r\n        //每帧更新计时器，超过限度还没生成新的星星的就调用游戏失败逻辑\r\n        if(this.timer > this.starDuration){\r\n            this.gameOver();\r\n        }\r\n        this.timer += dt;\r\n     },\r\n});\r\n"]}