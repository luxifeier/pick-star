{"version":3,"sources":["..\\..\\..\\..\\assets\\scripts/assets\\scripts\\Player.js"],"names":["cc","Class","extends","Component","properties","jumpHeight","jumpDuration","maxMoveSpeed","accel","originPos","default","type","Node","jumpAudio","AudioClip","startMoveAt","onMove","enabled","xSpeed","node","setPosition","v2","runAction","JumpAction","setJumpAction","jumpUp","moveBy","easing","easeCubicActionIn","jumpDown","callback","callFunc","playJumpSound","repeatForever","sequence","audioEngine","playEffect","onTouchStart","event","xTouchPos","convertToNodeSpaceAR","getLocation","x","xPos","getPosition","accLeft","accRight","onTouchEnd","onLoad","parent","on","onDestroy","off","update","dt","Math","abs","width"],"mappings":"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","file":"Player.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // 主角跳跃高度\r\n        jumpHeight: 0,\r\n        // 主角跳跃持续时间\r\n        jumpDuration: 0,\r\n        // 最大移动速度\r\n        maxMoveSpeed: 0,\r\n        // 加速度\r\n        accel: 0,\r\n        //声明originPos属性\r\n        originPos:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        //跳跃音效资源引用\r\n        jumpAudio:{\r\n            default:null,\r\n            type:cc.AudioClip\r\n        },\r\n    },\r\n    startMoveAt:function(){\r\n        //开启触屏监听\r\n        this.onMove();\r\n        //启用Player组件\r\n        this.enabled = true;\r\n        //设置Player组件xSpeed属性为0\r\n        this.xSpeed = 0;\r\n        //初始化Player位置\r\n        this.node.setPosition(cc.v2(0,-144));\r\n        //开始跳动\r\n        this.node.runAction(this.JumpAction);\r\n    },\r\n    setJumpAction:function(){\r\n        //向上跳跃\r\n        var jumpUp = cc.moveBy(this.jumpDuration,cc.v2(0,this.jumpHeight)).easing(cc.easeCubicActionIn());\r\n        //向下跳跃\r\n        var jumpDown = cc.moveBy(this.jumpDuration,cc.v2(0,-this.jumpHeight)).easing(cc.easeCubicActionIn());\r\n        //添加一个回调函数，用于在动作结束时回调\r\n        var callback = cc.callFunc(this.playJumpSound,this);\r\n        //不断重复上下跳跃动作\r\n        return cc.repeatForever(cc.sequence(jumpUp,jumpDown,callback));\r\n    },\r\n    playJumpSound:function(){\r\n        //调用cc.audioengine播放音频\r\n        cc.audioEngine.playEffect(this.jumpAudio,false);\r\n    },\r\n     onTouchStart:function(event){//触屏开始\r\n        //获取当前点击点的全局坐标,转化为originPos节点空间坐标系\r\n        this.xTouchPos = this.originPos.convertToNodeSpaceAR(event.getLocation()).x;\r\n        this.xPos = this.node.getPosition().x;\r\n       if(this.xTouchPos<this.xPos){//说明触点在Player节点的左边\r\n            this.accLeft = true;\r\n       }\r\n       else{\r\n           this.accRight = true;\r\n       }\r\n    },\r\n    onTouchEnd:function(event){//触屏结束\r\n        if(this.xTouchPos<this.xPos){\r\n            this.accLeft = false;\r\n        }\r\n        else{\r\n            this.accRight = false;\r\n        }\r\n    },\r\n     onLoad(){//场景加载后执行onLoad()方法\r\n        //初始化Player节点动作\r\n         this.JumpAction = this.setJumpAction();//返回执行的动作\r\n        // this.node.runAction(this.JumpAction);//执行并返回该执行的动作。该节点将会变成动作的目标\r\n\r\n         //初始化加速度方向开关\r\n        this.accLeft = false;\r\n        this.accRight = false;\r\n\r\n        //主角当前水平方向的速度\r\n        this.xSpeed = 0;\r\n     },\r\n     onMove(){\r\n         //初始化触屏监听\r\n         this.node.parent.on('touchstart',this.onTouchStart,this);\r\n         this.node.parent.on('touchend',this.onTouchEnd,this);\r\n     },\r\n     onDestroy(){\r\n         this.node.parent.off('touchstart',this.onTouchStart,this);\r\n         this.node.parent.off('touchend',this.onTouchEnd,this);\r\n     },\r\n     update (dt) {\r\n         //根据当前加速度方向每帧更新加速度\r\n         if(this.accLeft){\r\n            this.xSpeed -= this.accel * dt;\r\n         }\r\n         else if(this.accRight){\r\n             this.xSpeed += this.accel * dt;\r\n         }\r\n         //限制主角的最大加速度不能超过maxMoveSpeed\r\n         if(Math.abs(this.xSpeed) > this.maxMoveSpeed){\r\n            //如果加速度超过了最大加速度，就设置当前加速度为最大加速度\r\n            this.xSpeed = this.maxMoveSpeed * this.xSpeed / Math.abs(this.xSpeed);\r\n         }\r\n         //根据当前加速度更新Player节点位置\r\n         this.node.x += this.xSpeed * dt;\r\n         //限制主角移动范围不能超出屏幕\r\n         if(this.node.x > this.node.parent.width/2){//player节点已经超出屏幕右边\r\n            this.node.x = this.node.parent.width/2;\r\n            this.xSpeed = 0;\r\n         }\r\n         else if(this.node.x < -this.node.parent.width/2){//player节点已经超出屏幕左边\r\n            this.node.x = -this.node.parent.width/2;\r\n            this.xSpeed = 0;\r\n         }\r\n     },\r\n});\r\n"]}