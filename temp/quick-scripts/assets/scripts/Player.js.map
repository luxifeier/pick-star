{"version":3,"sources":["Player.js"],"names":["cc","Class","extends","Component","properties","jumpHeight","jumpDuration","maxMoveSpeed","accel","originPos","default","type","Node","jumpAudio","AudioClip","setJumpAction","jumpUp","moveBy","v2","easing","easeCubicActionIn","jumpDown","callback","callFunc","playJumpSound","repeatForever","sequence","audioEngine","playEffect","onTouchStart","event","xTouchPos","convertToNodeSpaceAR","getLocation","x","xPos","node","getPosition","accLeft","accRight","onTouchEnd","onLoad","JumpAction","runAction","xSpeed","parent","on","onDestroy","off","update","dt","Math","abs","width"],"mappings":"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","file":"Player.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        // 主角跳跃高度\r\n        jumpHeight: 0,\r\n        // 主角跳跃持续时间\r\n        jumpDuration: 0,\r\n        // 最大移动速度\r\n        maxMoveSpeed: 0,\r\n        // 加速度\r\n        accel: 0,\r\n        //声明originPos属性\r\n        originPos:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        //跳跃音效资源引用\r\n        jumpAudio:{\r\n            default:null,\r\n            type:cc.AudioClip\r\n        },\r\n    },\r\n    setJumpAction:function(){\r\n        //向上跳跃\r\n        var jumpUp = cc.moveBy(this.jumpDuration,cc.v2(0,this.jumpHeight)).easing(cc.easeCubicActionIn());\r\n        //向下跳跃\r\n        var jumpDown = cc.moveBy(this.jumpDuration,cc.v2(0,-this.jumpHeight)).easing(cc.easeCubicActionIn());\r\n        //添加一个回调函数，用于在动作结束时回调\r\n        var callback = cc.callFunc(this.playJumpSound,this);\r\n        //不断重复上下跳跃动作\r\n        return cc.repeatForever(cc.sequence(jumpUp,jumpDown,callback));\r\n    },\r\n    playJumpSound:function(){\r\n        //调用cc.audioengine播放音频\r\n        cc.audioEngine.playEffect(this.jumpAudio,false);\r\n    },\r\n     onTouchStart:function(event){//触屏开始\r\n        //获取当前点击点的全局坐标,转化为originPos节点空间坐标系\r\n        this.xTouchPos = this.originPos.convertToNodeSpaceAR(event.getLocation()).x;\r\n        this.xPos = this.node.getPosition().x;\r\n       if(this.xTouchPos<this.xPos){//说明触点在Player节点的左边\r\n            this.accLeft = true;\r\n       }\r\n       else{\r\n           this.accRight = true;\r\n       }\r\n    },\r\n    onTouchEnd:function(event){//触屏结束\r\n        if(this.xTouchPos<this.xPos){\r\n            this.accLeft = false;\r\n        }\r\n        else{\r\n            this.accRight = false;\r\n        }\r\n    },\r\n     onLoad(){//场景加载后执行onLoad()方法\r\n         this.JumpAction = this.setJumpAction();//返回执行的动作\r\n         this.node.runAction(this.JumpAction);//执行并返回该执行的动作。该节点将会变成动作的目标\r\n\r\n         //初始化加速度方向开关\r\n        this.accLeft = false;\r\n        this.accRight = false;\r\n\r\n        //主角当前水平方向的速度\r\n        this.xSpeed = 0;\r\n\r\n         //初始化触屏监听\r\n         this.node.parent.on('touchstart',this.onTouchStart,this);\r\n         this.node.parent.on('touchend',this.onTouchEnd,this);\r\n     },\r\n     onDestroy(){\r\n         this.node.parent.off('touchstart',this.onTouchStart,this);\r\n         this.node.parent.off('touchend',this.onTouchEnd,this);\r\n     },\r\n     update (dt) {\r\n         //根据当前加速度方向每帧更新加速度\r\n         if(this.accLeft){\r\n            this.xSpeed -= this.accel * dt;\r\n         }\r\n         else if(this.accRight){\r\n             this.xSpeed += this.accel * dt;\r\n         }\r\n         //限制主角的最大加速度不能超过maxMoveSpeed\r\n         if(Math.abs(this.xSpeed) > this.maxMoveSpeed){\r\n            //如果加速度超过了最大加速度，就设置当前加速度为最大加速度\r\n            this.xSpeed = this.maxMoveSpeed * this.xSpeed / Math.abs(this.xSpeed);\r\n         }\r\n         //根据当前加速度更新Player节点位置\r\n         this.node.x += this.xSpeed * dt;\r\n         //限制主角移动范围不能超出屏幕\r\n         if(this.node.x > this.node.parent.width/2){//player节点已经超出屏幕右边\r\n            this.node.x = this.node.parent.width/2;\r\n            this.xSpeed = 0;\r\n         }\r\n         else if(this.node.x < -this.node.parent.width/2){//player节点已经超出屏幕左边\r\n            this.node.x = -this.node.parent.width/2;\r\n            this.xSpeed = 0;\r\n         }\r\n     },\r\n});\r\n"]}