{"version":3,"sources":["Game.js"],"names":["cc","Class","extends","Component","properties","starPreFab","default","type","Prefab","maxStarDuration","minStarDuration","ground","Node","player","scoreDisplay","Label","scoreAudio","AudioClip","btnNote","gameOverNote","onLoad","groundY","y","height","timer","starDuration","score","active","enabled","onStartGame","x","getComponent","startMoveAt","spawnNewStar","gainScore","string","audioEngine","playEffect","gameOver","stopAllActions","xSpeed","onDestroy","scheduleOnce","reLoad","director","loadScene","newStar","instantiate","node","addChild","setPosition","getNewStarPosition","game","Math","random","randX","randY","jumpHeight","maxX","width","v2","update","dt"],"mappings":"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","file":"Game.js","sourceRoot":"..\\..\\..\\..\\assets\\scripts","sourcesContent":["cc.Class({\r\n    extends: cc.Component,\r\n\r\n    properties: {\r\n        //这个属性引用星星的预制资源\r\n        starPreFab:{\r\n            default:null,\r\n            type:cc.Prefab\r\n        },\r\n        //星星消失后时间的随机范围\r\n        maxStarDuration:0,\r\n        minStarDuration:0,\r\n        //地面节点用于生成星星生成的高度\r\n        ground:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        //player节点，用于获取主角的高度\r\n        player:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        //score label引用\r\n        scoreDisplay:{\r\n            default:null,\r\n            type:cc.Label\r\n        },\r\n        //得分音效引用\r\n        scoreAudio:{\r\n            default:null,\r\n            type:cc.AudioClip\r\n        },\r\n        //button 节点引用\r\n        btnNote:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n        //GameOver节点引用\r\n        gameOverNote:{\r\n            default:null,\r\n            type:cc.Node\r\n        },\r\n    },\r\n\r\n     onLoad () {\r\n         //获取地平面的的y轴坐标\r\n         this.groundY = this.ground.y + this.ground.height/2;\r\n         //初始化计时器\r\n         this.timer = 0;\r\n         this.starDuration = 0;\r\n         //初始化score\r\n         this.score = 0;\r\n         //隐藏GameOver节点,禁用Game组件\r\n         this.gameOverNote.active = false;\r\n         this.enabled = false;\r\n     },\r\n     //play按钮被点击后，响应onStartGame()\r\n     onStartGame:function(){\r\n         this.enabled = true;\r\n         //将button按钮移出可视区域\r\n         this.btnNote.x = 3000;\r\n         //Player开始运动\r\n         this.player.getComponent('Player').startMoveAt();\r\n         //星星随机显示\r\n         this.spawnNewStar();\r\n     },\r\n     gainScore:function(){//计算得分\r\n        this.score += 1;//每摘到一个星星score加一\r\n        this.scoreDisplay.string = 'Score:' + this.score;\r\n        //播放得分音效\r\n        cc.audioEngine.playEffect(this.scoreAudio,false);\r\n     },\r\n     gameOver:function(){//游戏结束\r\n        //停止Player节点的跳跃动作\r\n       this.player.stopAllActions();\r\n       this.player.getComponent('Player').xSpeed = 0;\r\n       this.player.getComponent('Player').onDestroy();\r\n       this.gameOverNote.active = true;\r\n       //延迟1秒重新加载场景\r\n       this.scheduleOnce(this.reLoad,1);\r\n     },\r\n     reLoad:function(){\r\n        cc.director.loadScene('game');\r\n     },\r\n     spawnNewStar:function(){\r\n         //使用预制资源生成一个新的节点\r\n         var newStar = cc.instantiate(this.starPreFab);\r\n         //将生成的节点添加到Canvas节点下\r\n         this.node.addChild(newStar);\r\n         //为星星设置一个随机位置\r\n         newStar.setPosition(this.getNewStarPosition());\r\n         //在星星组件上暂存Game对象的引用\r\n         newStar.getComponent('Star').game = this;\r\n         //重置计数器，根据消失时间随机一个数\r\n         this.starDuration = this.minStarDuration + Math.random() * (this.maxStarDuration-this.minStarDuration);\r\n         this.timer = 0;\r\n     },\r\n     getNewStarPosition:function(){\r\n         var randX = 0;\r\n         //根据地平线的位置和主角高度，随机得到星星的y坐标\r\n         var randY = this.groundY + Math.random() * this.player.getComponent('Player').jumpHeight + 50;\r\n         //根据屏幕宽度，随机星星的x轴坐标\r\n         var maxX = this.node.width/2;\r\n         randX = (Math.random() - 0.5) * 2 * maxX;\r\n         //返回星星坐标\r\n         return cc.v2(randX,randY);\r\n     },\r\n     update (dt) {\r\n        //每帧更新计时器，超过限度还没生成新的星星的就调用游戏失败逻辑\r\n        if(this.timer > this.starDuration){\r\n            this.gameOver();\r\n        }\r\n         this.timer += dt;\r\n     },\r\n});\r\n"]}